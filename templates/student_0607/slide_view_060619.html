<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ slide.content.title }} - í•™ìŠµ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/student/student.css">
  
</head>
<body class="bg-slate-50">
    <!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileSidebar()"></div>
    
    <!-- ë¯¸ë‹ˆ ì‚¬ì´ë“œë°” -->
    {% include 'student/pages/nav.html' %}

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="main-content min-h-screen">
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20 shadow-sm">
            <div class="px-4 sm:px-6 lg:px-8">
                <!-- ëª¨ë°”ì¼ í—¤ë” -->
                <div class="md:hidden py-3 flex items-center justify-between">
                    <button onclick="showMobileSidebar()" class="p-2 text-gray-600 hover:text-gray-900">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-lg font-semibold text-gray-900 truncate flex-1 mx-3">
                        {{ slide.chasi.chasi_title }}
                    </h1>
                    <a href="{% url 'student:learning_course' slide.chasi.sub_chapter.chapter.subject.id %}" 
                       class="p-2 text-gray-600 hover:text-gray-900">
                        <i class="fas fa-times text-xl"></i>
                    </a>
                </div>
                
                <!-- ë°ìŠ¤í¬í†± í—¤ë” -->
                <div class="hidden md:block py-2">
                    <div class="flex items-center justify-between">
                        <nav class="flex items-center text-base">
                            <a href="{% url 'student:course_list' %}" class="text-gray-600 hover:text-gray-900 font-medium transition flex items-center gap-2">
                                <i class="fas fa-book text-gray-400"></i>
                                <span class="hidden lg:inline">{{ slide.chasi.sub_chapter.chapter.subject.subject_name }}</span>
                                <span class="lg:hidden">ê³¼ëª©</span>
                            </a>
                            <i class="fas fa-chevron-right mx-3 text-xs text-gray-400"></i>
                            <span class="text-gray-600 hidden lg:inline">{{ slide.chasi.sub_chapter.chapter.chapter_title }}</span>
                            <span class="text-gray-600 lg:hidden">{{ slide.chasi.sub_chapter.chapter.chapter_order }}ë‹¨ì›</span>
                            <i class="fas fa-chevron-right mx-3 text-xs text-gray-400"></i>
                            <span class="text-gray-600 hidden lg:inline">{{ slide.chasi.sub_chapter.sub_chapter_title }}</span>
                            <span class="text-gray-600 lg:hidden">{{ slide.chasi.sub_chapter.sub_chapter_order }}ì ˆ</span>
                            <i class="fas fa-chevron-right mx-3 text-xs text-gray-400"></i>
                            <span class="text-gray-900 font-medium">{{ slide.chasi.chasi_title }}</span>
                        </nav>
                        
                        <a href="{% url 'student:learning_course' slide.chasi.sub_chapter.chapter.subject.id %}" 
                           class="p-2 text-gray-400 hover:text-gray-600 transition rounded-lg hover:bg-gray-100"
                           title="ì½”ìŠ¤ë¡œ ëŒì•„ê°€ê¸°">
                            <i class="fas fa-times text-lg"></i>
                        </a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- ì½˜í…ì¸  ì˜ì—­ -->
        <main class="max-w-4xl mx-auto px-6 py-2">
        <div class="content-card bg-white rounded-2xl shadow-lg overflow-hidden mb-8 max-w-4xl flex flex-col justify-start items-center">
        <!-- ì½˜í…ì¸  ë³¸ë¬¸ ë¶€ë¶„ (ê¸°ì¡´ ì½”ë“œì—ì„œ ìˆ˜ì •) -->
          <!-- ìŠ¬ë¼ì´ë“œ í—¤ë” -->
          <div class="px-8 py-2 bg-gradient-to-r from-slate-1000 to-blue-50 border-b border-gray2100 w-full">
            <div class="flex items-center justify-between">
              
                    <h1 class="text-2xl font-bold text-gray-900 ml-4">ğŸš€ {{ slide.content.title }}</h1>
                    <div class="flex items-center gap-4">
                        <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-{{ slide.content_type.color|default:'blue' }}-100 text-{{ slide.content_type.color|default:'blue' }}-800 border border-{{ slide.content_type.color|default:'blue' }}-200">
                            <i class="fas fa-{{ slide.content_type.icon|default:'file' }} mr-1.5"></i>
                            {{ slide.content_type.type_name }}
                        </span>
                        <span class="text-sm text-gray-600">
                            <i class="far fa-clock mr-1.5"></i>{{ slide.estimated_time|default:"15" }}ë¶„
                        </span>
                        <span class="text-sm text-gray-600">
                            <i class="fas fa-eye mr-1.5"></i>{{ progress.view_count|default:0 }}íšŒ
                        </span>
                    </div>
               
            </div>
        </div>
        <div class="px-4 sm:px-6 lg:px-8 py-2 sm:py-2 relative">
            <div class="prose prose-sm sm:prose-base lg:prose-lg max-w-none mx-auto">
                {{ slide.content.page|safe }}
            </div>
            
            {% if existing_answer %}
            <!-- ê²°ê³¼ GIF í‘œì‹œ ì˜ì—­ -->
            <div class="text-center mt-6 absolute top-10 left-10">
                {% if is_already_correct %}
                <img id="right-gif" src="/static/img/jungoh/images/right.gif" alt="ì •ë‹µ" class="result-gif mx-auto mb-4">
                {% else %}
                <img id="wrong-gif" src="/static/img/jungoh/images/wrong.gif" alt="ì˜¤ë‹µ" class="result-gif mx-auto mb-4">
                {% endif %}
            </div>

            {% endif %}
            
            <!-- ì œì¶œ ë²„íŠ¼ ì˜ì—­ -->
            {% if slide.content_type.type_name in 'multiple-choice,short-answer' %}
            <div id="submission-area" class="mt-8 text-center border-t border-gray-200 pt-6">
                <!-- ì œì¶œ ë²„íŠ¼ (ì´ˆê¸° ì œì¶œ) -->
                {% if not is_already_correct %}
                <button id="submit-btn" 
                        class="submit-button bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-lg transition duration-200 shadow-sm text-base mr-3"
                        data-qid="{{ slide.content.id }}" 
                        data-type="{{ slide.content_type.type_name }}"
                        style="display: {% if existing_answer %}none{% else %}inline-block{% endif %};">
                    <i class="fas fa-paper-plane mr-2"></i>ë‹µì•ˆ ì œì¶œ
                </button>
                
                <!-- ì¬ì œì¶œ ë²„íŠ¼ -->
                <button id="resubmit-btn" 
                        class="resubmit-button bg-orange-600 hover:bg-orange-700 text-white font-medium px-6 py-3 rounded-lg transition duration-200 shadow-sm text-base"
                        data-qid="{{ slide.content.id }}" 
                        data-type="{{ slide.content_type.type_name }}"
                        style="display: {% if existing_answer %}inline-block{% else %}none{% endif %};">
                    <i class="fas fa-redo mr-2"></i>ë‹¤ì‹œ ì œì¶œ
                </button>
                {% endif %}
                
                <div id="submission-status-wrapper"> 
                <!-- ì œì¶œ ìƒíƒœ í‘œì‹œ -->
                {% if existing_answer %}
                <div class="mt-4 text-sm text-gray-600">
                    <i class="fas fa-info-circle mr-1"></i>
                    ì´ì „ ì œì¶œ: {{ existing_answer.submitted_at|date:"Y-m-d H:i" }}
                    {% if existing_answer.is_correct %}
                        <span class="text-green-600 font-medium ml-2">
                            <i class="fas fa-check-circle"></i> ì •ë‹µ
                        </span>
                    {% elif existing_answer.is_correct == False %}
                        <span class="text-red-600 font-medium ml-2">
                            <i class="fas fa-times-circle"></i> ì˜¤ë‹µ
                        </span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
      </div>
      </main>
    </div>

    <!-- í•˜ë‹¨ ê³ ì • ì¸ë””ì¼€ì´í„° -->
    <div class="bottom-indicator">
        <div class="px-4 sm:px-6 py-1 flex items-center justify-between">
            <!-- ì´ì „ ë²„íŠ¼ -->
            <div class="flex-shrink-0">
                {% if prev_slide %}
                <a href="{% url 'student:slide_view' prev_slide.id %}" 
                   class="flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition shadow-sm text-sm sm:text-base">
                    <i class="fas fa-chevron-left text-xs sm:text-sm"></i>
                    <span class="hidden sm:inline">ì´ì „</span>
                </a>
                {% else %}
                <div class="w-16 sm:w-20"></div>
                {% endif %}
            </div>
            
            <!-- ì§„ë„ í‘œì‹œ -->
            <div class="flex-1 mx-3 sm:mx-6 overflow-hidden">
                <div class="flex items-center gap-2">
                    <div class="flex-1 flex gap-1.5 sm:gap-2 overflow-x-auto scrollbar-hide justify-center">
                        {% for s in slide.chasi.teacher_slides.all %}
                        <div class="progress-dot {% if s.id == slide.id %}current{% elif progress_data and s.id in progress_data and progress_data.s.id.is_completed %}completed{% endif %}"
                             onclick="{% if s.id != slide.id %}location.href='{% url 'student:slide_view' s.id %}'{% endif %}"
                             title="ìŠ¬ë¼ì´ë“œ {{ s.slide_number }}"></div>
                        {% endfor %}
                    </div>
                    <div class="text-xs sm:text-sm text-gray-600 font-medium whitespace-nowrap ml-2">
                        <span class="text-gray-900">{{ slide.slide_number }}</span>/{{ slide.chasi.teacher_slides.count }}
                    </div>
                </div>
            </div>
            
            <!-- ë‹¤ìŒ/ì™„ë£Œ ë²„íŠ¼ -->
            <div class="flex-shrink-0">
                {% if next_slide %}
                <a href="{% url 'student:slide_view' next_slide.id %}" 
                   class="flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition shadow-sm text-sm sm:text-base">
                    <span class="hidden sm:inline">ë‹¤ìŒ</span>
                    <i class="fas fa-chevron-right text-xs sm:text-sm"></i>
                </a>
                {% else %}
                <a href="{% url 'student:learning_course' slide.chasi.sub_chapter.chapter.subject.id %}" 
                   class="flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition shadow-sm text-sm sm:text-base">
                    <span class="hidden sm:inline">ì™„ë£Œ</span>
                    <i class="fas fa-check text-xs sm:text-sm"></i>
                </a>
                {% endif %}
            </div>
        </div>
        
        <!-- ë©”ì‹œì§€ ì˜ì—­ -->
        {% if messages %}
        <div class="px-4 sm:px-6 pb-2">
            {% for message in messages %}
            <div class="text-xs sm:text-sm px-3 py-1.5 rounded-lg mb-1 {% if message.level_tag == 'success' %}bg-green-100 text-green-700{% elif message.level_tag == 'error' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- ë…¸íŠ¸ íŒì—… -->
    <div id="notePopup" class="fixed right-4 sm:right-6 bottom-24 sm:bottom-28 w-[calc(100vw-2rem)] sm:w-96 max-w-md bg-white rounded-xl sm:rounded-2xl shadow-2xl border border-gray-200 hidden z-40">
        <div class="px-4 sm:px-5 py-3 sm:py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl sm:rounded-t-2xl">
            <h3 class="font-semibold text-gray-900 text-sm sm:text-base">
                <i class="fas fa-sticky-note text-yellow-500 mr-2"></i>í•™ìŠµ ë…¸íŠ¸
            </h3>
            <button onclick="toggleNote()" class="text-gray-400 hover:text-gray-600 transition">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="p-4 sm:p-5">
            <textarea id="noteContent" 
                      class="w-full h-48 sm:h-64 p-3 sm:p-4 border border-gray-200 rounded-lg sm:rounded-xl resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-xs sm:text-sm"
                      placeholder="í•™ìŠµí•˜ë©´ì„œ ì¤‘ìš”í•œ ë‚´ìš©ì´ë‚˜ ê¶ê¸ˆí•œ ì ì„ ë©”ëª¨í•˜ì„¸ìš”...">{{ note.content|default:'' }}</textarea>
            <div class="mt-3 flex justify-end">
                <button onclick="saveNote()" 
                        class="px-4 sm:px-5 py-2 bg-blue-600 text-white font-medium rounded-lg sm:rounded-xl hover:bg-blue-700 transition shadow-sm text-sm">
                    <i class="fas fa-save mr-2"></i>ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <!-- í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼ (ëª¨ë°”ì¼) -->
    <div class="fixed right-4 bottom-20 flex flex-col gap-2 sm:hidden z-20">
        <button onclick="toggleNote()" 
                class="w-12 h-12 bg-white border border-gray-300 text-gray-600 rounded-full shadow-lg hover:shadow-xl transition flex items-center justify-center">
            <i class="fas fa-sticky-note"></i>
        </button>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div id="toastContainer"></div>

    <script>


        // ë¯¸ë‹ˆ ì‚¬ì´ë“œë°” í† ê¸€ (ë°ìŠ¤í¬í†±)
        function toggleMiniSidebar() {
            const sidebar = document.getElementById('miniSidebar');
            const isDesktop = window.innerWidth >= 768;
            
            if (isDesktop) {
                sidebar.classList.toggle('expanded');
            } else {
                closeMobileSidebar();
            }
        }

        // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” í‘œì‹œ
        function showMobileSidebar() {
            const sidebar = document.getElementById('miniSidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.add('show-mobile');
            overlay.classList.add('show');
        }

        // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” ë‹«ê¸°
        function closeMobileSidebar() {
            const sidebar = document.getElementById('miniSidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.remove('show-mobile');
            overlay.classList.remove('show');
        }

        // ë‹µì•ˆ ì œì¶œ
        function submitAnswer() {
            const contentArea = document.querySelector('.prose');
            const answerInputs = contentArea.querySelectorAll('input[name="student_answer"], textarea[name="student_answer"], select[name="student_answer"]');
            
            let answer = '';
            
            answerInputs.forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    if (input.checked) {
                        answer = input.value;
                    }
                } else if (input.value) {
                    answer = input.value;
                }
            });
            
            if (!answer.trim()) {
                showToast('ë‹µì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }
            
            document.getElementById('hiddenAnswer').value = answer;
            return true;
        }

        // ë…¸íŠ¸ í† ê¸€
        function toggleNote() {
            const notePopup = document.getElementById('notePopup');
            notePopup.classList.toggle('hidden');
        }

        // ë…¸íŠ¸ ì €ì¥
        function saveNote() {
            const content = document.getElementById('noteContent').value;
            
            fetch('{% url "student:save_note_ajax" slide.id %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'note_content=' + encodeURIComponent(content)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showToast('ë…¸íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            })
            .catch(() => {
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = {
                'success': 'bg-green-600',
                'error': 'bg-red-600',
                'info': 'bg-blue-600'
            }[type] || 'bg-gray-600';
            
            toast.className = `toast ${bgColor} text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-lg sm:rounded-xl shadow-lg mb-3 flex items-center gap-2 sm:gap-3 text-sm`;
            toast.style.animation = 'slideIn 0.3s ease-out';
            
            const icon = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'info': 'fas fa-info-circle'
            }[type] || 'fas fa-info-circle';
            
            toast.innerHTML = `<i class="${icon}"></i><span>${message}</span>`;
            
            const container = document.getElementById('toastContainer');
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
            // ESC: ì‚¬ì´ë“œë°”/ë…¸íŠ¸ ë‹«ê¸°
            if (e.key === 'Escape') {
                const notePopup = document.getElementById('notePopup');
                const sidebar = document.getElementById('miniSidebar');
                
                if (!notePopup.classList.contains('hidden')) {
                    notePopup.classList.add('hidden');
                } else if (sidebar.classList.contains('expanded') || sidebar.classList.contains('show-mobile')) {
                    closeMobileSidebar();
                    sidebar.classList.remove('expanded');
                }
            }
            
            // ì¢Œìš° í™”ì‚´í‘œ: ì´ì „/ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ (ì…ë ¥ í•„ë“œê°€ ì•„ë‹ ë•Œë§Œ)
            if (!e.target.matches('input, textarea')) {
                if (e.key === 'ArrowLeft' && {% if prev_slide %}true{% else %}false{% endif %}) {
                    location.href = '{% if prev_slide %}{% url "student:slide_view" prev_slide.id %}{% endif %}';
                } else if (e.key === 'ArrowRight' && {% if next_slide %}true{% else %}false{% endif %}) {
                    location.href = '{% if next_slide %}{% url "student:slide_view" next_slide.id %}{% endif %}';
                }
            }
        });

        // ë°˜ì‘í˜• ì²˜ë¦¬
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const sidebar = document.getElementById('miniSidebar');
                const isDesktop = window.innerWidth >= 768;
                
                if (!isDesktop && sidebar.classList.contains('expanded')) {
                    sidebar.classList.remove('expanded');
                }
            }, 250);
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° ìŠ¤íƒ€ì¼ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = '.scrollbar-hide::-webkit-scrollbar { display: none; } .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }';
        document.head.appendChild(style);
        
        $(document).ready(function() {
    // ê¸°ì¡´ ë¬¸ì œ ì„ íƒ ë¡œì§
                $('.answer').click(function(){
                    var clicked = $(this).attr('data-clicked');
                    $('.answer').removeClass('ring-2 ring-red-500 ring-blue-500');
                    console.log("clicked:", clicked);
                    
                    // ëª¨ë“  gif ìˆ¨ê¸°ê¸°
                    $('#right-gif').addClass('hidden');
                    $('#wrong-gif').addClass('hidden');
                
                    $(this).addClass('ring-2');
                    
                    if (clicked == '1'){
                        $(this).addClass('ring-blue-500');
                    } else {
                        $(this).addClass('ring-red-500');
                    }
                });

        // ì œì¶œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $('.submit-button, .resubmit-button').click(function(){
            var qid = $(this).attr('data-qid');
            var qtype = $(this).attr('data-type');
            var isResubmit = $(this).hasClass('resubmit-button');
            
            // ì„ íƒëœ ë‹µì•ˆ ìˆ˜ì§‘
            var selectedAnswer = getSelectedAnswer();
            
            if (!selectedAnswer) {
                showToast('ë‹µì•ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
            $(this).prop('disabled', true).text('ì œì¶œ ì¤‘...');
            
            // ì„œë²„ì— ë‹µì•ˆ ì œì¶œ
            submitAnswerToServer(qid, selectedAnswer, isResubmit, $(this));
        });
    
        // ì„ íƒëœ ë‹µì•ˆ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function getSelectedAnswer() {
            var answer = null;
            
            // ê°ê´€ì‹/ì„ íƒí˜•ì˜ ê²½ìš°
            $('.answer.ring-2').each(function(){
                answer = $(this).attr('data-clicked');
            });
            
            // ë‹¨ë‹µí˜•ì˜ ê²½ìš° (input í•„ë“œ)
            if (!answer) {
                var textInput = $('input[name="student_answer"], textarea[name="student_answer"]');
                if (textInput.length > 0 && textInput.val().trim()) {
                    answer = textInput.val().trim();
                }
            }
            
            return answer;
        }
    
        // ì„œë²„ì— ë‹µì•ˆ ì œì¶œ í•¨ìˆ˜ (â˜…â˜…â˜…â˜…â˜… ì „ì²´ êµì²´ â˜…â˜…â˜…â˜…â˜…)
            function submitAnswerToServer(qid, answer, isResubmit, buttonElement) {
                // is_resubmit ê°’ì€ ì´ì œ ì„œë²„ì˜ update_or_create ë¡œì§ìœ¼ë¡œ ì¸í•´
                // ì‚¬ì‹¤ìƒ í•„ìš” ì—†ì§€ë§Œ, ê¸°ì¡´ êµ¬ì¡° ìœ ì§€ë¥¼ ìœ„í•´ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤.
                $.ajax({
                    url: '{% url "student:check_answer" %}',
                    type: 'POST',
                    data: {
                        'content_id': qid,
                        'student_answer': answer,
                        'slide_id': {{ slide.id }},
                        // 'is_resubmit' íŒŒë¼ë¯¸í„°ëŠ” ë” ì´ìƒ check_answer ë·°ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        console.log('ì„œë²„ ì‘ë‹µ:', response);

                        if (response.status !== 'success') {
                            showToast(response.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                            return;
                        }

                        // 1. GIF í‘œì‹œ ì—…ë°ì´íŠ¸
                        if (response.is_correct) {
                            $('#right-gif').removeClass('hidden');
                            $('#wrong-gif').addClass('hidden');
                            showToast('ì •ë‹µì…ë‹ˆë‹¤! ì˜í–ˆì–´ìš”!', 'success');
                        } else {
                            $('#wrong-gif').removeClass('hidden');
                            $('#right-gif').addClass('hidden');
                            showToast('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.', 'error');
                        }

                        // 2. ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                        if (response.is_correct) {
                            // ì •ë‹µì´ë©´ ëª¨ë“  ì œì¶œ ë²„íŠ¼ ìˆ¨ê¹€
                            $('#submit-btn').hide();
                            $('#resubmit-btn').hide();
                        } else {
                            // ì˜¤ë‹µì´ë©´ 'ë‹¤ì‹œ ì œì¶œ' ë²„íŠ¼ì„ ë³´ì—¬ì£¼ê³  í™œì„±í™”
                            $('#submit-btn').hide();
                            $('#resubmit-btn').show().prop('disabled', false).html('<i class="fas fa-redo mr-2"></i>ë‹¤ì‹œ ì œì¶œ');
                        }

                        // 3. ì œì¶œ ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                        updateSubmissionStatus(response);
                    },
                    error: function(xhr, status, error) {
                        console.error('ì œì¶œ ì˜¤ë¥˜:', error);
                        showToast('ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                        // ì—ëŸ¬ ë°œìƒ ì‹œ ë²„íŠ¼ ì›ìƒ ë³µêµ¬
                        buttonElement.prop('disabled', false);
                        if (buttonElement.hasClass('submit-button')) {
                            buttonElement.html('<i class="fas fa-paper-plane mr-2"></i>ë‹µì•ˆ ì œì¶œ');
                        } else {
                            buttonElement.html('<i class="fas fa-redo mr-2"></i>ë‹¤ì‹œ ì œì¶œ');
                        }
                    }
                    // 'complete' ì½œë°±ì€ success/errorì—ì„œ ê°œë³„ ì²˜ë¦¬í•˜ë¯€ë¡œ ì œê±°í•´ë„ ë¬´ë°©í•©ë‹ˆë‹¤.
                });
            }

            // ì œì¶œ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (â˜…â˜…â˜…â˜…â˜… ì „ì²´ êµì²´ â˜…â˜…â˜…â˜…â˜…)
            function updateSubmissionStatus(response) {
                const wrapper = $('#submission-status-wrapper');
                wrapper.empty(); // ì´ì „ ìƒíƒœ ë©”ì‹œì§€ ëª¨ë‘ ì œê±°

                const statusIcon = response.is_correct
                    ? '<span class="text-green-600 font-medium ml-2"><i class="fas fa-check-circle"></i> ì •ë‹µ</span>'
                    : '<span class="text-red-600 font-medium ml-2"><i class="fas fa-times-circle"></i> ì˜¤ë‹µ</span>';

                const statusHtml = `
                    <div class="mt-4 text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-1"></i>
                        ë§ˆì§€ë§‰ ì œì¶œ: ${response.submitted_at}
                        ${statusIcon}
                    </div>
                `;

                wrapper.html(statusHtml);
            }
    });

// ê¸°ì¡´ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€...
</script>
</body>
</html>