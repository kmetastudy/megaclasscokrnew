{% extends 'teacher/base.html' %}
{% load static %}

{% block title %}ì‹ ì²´í™œë™ ê¸°ë¡ í†µê³„{% endblock %}

{% block content %}
<style>
/* Chart.js ì»¨í…Œì´ë„ˆ ë†’ì´ ê³ ì • */
.chart-container {
    position: relative;
    height: 250px !important;
    width: 100%;
}
.chart-container canvas {
    max-height: 250px !important;
}
</style>

<div class="min-h-screen bg-gray-50 py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- í—¤ë” ë° ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl shadow-sm p-6 mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="text-3xl mr-3">ğŸƒâ€â™‚ï¸</span>
                ì‹ ì²´í™œë™ ê¸°ë¡ í†µê³„
            </h1>
            
            <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
            <div class="flex flex-wrap gap-2">
                <a href="{% url 'teacher:statistics_dashboard' %}" 
                   class="px-4 py-2 rounded-lg font-medium text-gray-600 bg-white border border-gray-200 hover:bg-gray-50 transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-chart-line text-sm"></i>
                    <span>ê°œìš”</span>
                </a>
                <a href="{% url 'teacher:statistics_by_class' %}" 
                   class="px-4 py-2 rounded-lg font-medium text-gray-600 bg-white border border-gray-200 hover:bg-gray-50 transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-users text-sm"></i>
                    <span>ë°˜ë³„ í†µê³„</span>
                </a>
                <a href="{% url 'teacher:statistics_by_course' %}" 
                   class="px-4 py-2 rounded-lg font-medium text-gray-600 bg-white border border-gray-200 hover:bg-gray-50 transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-book text-sm"></i>
                    <span>ì½”ìŠ¤ë³„ í†µê³„</span>
                </a>
                <a href="{% url 'teacher:submission_analysis' %}" 
                   class="px-4 py-2 rounded-lg font-medium text-gray-600 bg-white border border-gray-200 hover:bg-gray-50 transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-clipboard-check text-sm"></i>
                    <span>ì œì¶œ ë¶„ì„</span>
                </a>
                <a href="{% url 'teacher:weakness_analysis' %}" 
                   class="px-4 py-2 rounded-lg font-medium text-gray-600 bg-white border border-gray-200 hover:bg-gray-50 transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-chart-pie text-sm"></i>
                    <span>ì·¨ì•½ì  ë¶„ì„</span>
                </a>
                <a href="{% url 'teacher:physical_records' %}" 
                   class="px-4 py-2 rounded-lg font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 shadow-md transform scale-105 flex items-center gap-2">
                    <i class="fas fa-heartbeat text-sm"></i>
                    <span>ì‹ ì²´í™œë™</span>
                </a>
            </div>
        </div>

        <!-- í•„í„° ì„¹ì…˜ -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
            <form method="get" action="">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-filter text-indigo-500 mr-1"></i>í•„í„° ìœ í˜•
                        </label>
                        <select name="filter" onchange="this.form.submit()"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200">
                            <option value="class" {% if filter_type == 'class' %}selected{% endif %}>í•™ê¸‰ë³„</option>
                            <option value="student" {% if filter_type == 'student' %}selected{% endif %}>í•™ìƒë³„</option>
                        </select>
                    </div>
                    
                    <div class="md:col-span-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            {% if filter_type == 'class' %}
                                <i class="fas fa-users text-indigo-500 mr-1"></i>í•™ê¸‰ ì„ íƒ
                            {% else %}
                                <i class="fas fa-user-graduate text-indigo-500 mr-1"></i>í•™ìƒ ì„ íƒ
                            {% endif %}
                        </label>
                        <select name="id" onchange="this.form.submit()"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200">
                            <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                            {% if filter_type == 'class' %}
                                {% for class in classes %}
                                <option value="{{ class.id }}" {% if filter_id == class.id|stringformat:"s" %}selected{% endif %}>
                                    {{ class.name }}
                                </option>
                                {% endfor %}
                            {% else %}
                                {% for student in students %}
                                <option value="{{ student.id }}" {% if filter_id == student.id|stringformat:"s" %}selected{% endif %}>
                                    {{ student.user.get_full_name }} ({{ student.student_id }})
                                </option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    
                    <div class="md:col-span-3">
                        <button type="button" onclick="exportPhysicalData()" 
                                class="w-full bg-white text-green-600 border border-green-600 px-4 py-2 rounded-lg font-medium hover:bg-green-50 transition-colors duration-200 flex items-center justify-center gap-2">
                            <i class="fas fa-download"></i>
                            <span>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        {% if filter_id %}
            {% if filter_type == 'class' %}
                <!-- í•™ê¸‰ë³„ í†µê³„ ë·° -->
                
                <!-- ìš”ì•½ ì¹´ë“œ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <!-- ì•êµ¬ë¥´ê¸° í™œë™ ì¹´ë“œ -->
                    {% if rolling_stats %}
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">ì•êµ¬ë¥´ê¸° í™œë™</h3>
                            <span class="text-3xl">ğŸ¤¸â€â™‚ï¸</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ì´ ì‹œë„</span>
                                <span class="text-xl font-bold text-indigo-600">{{ rolling_stats.total_attempts }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ì°¸ì—¬ í•™ìƒ</span>
                                <span class="text-xl font-bold text-purple-600">{{ rolling_stats.unique_students }}ëª…</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- ì‹ ì²´ê¸°ë¡ ì¹´ë“œ -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">ì‹ ì²´ê¸°ë¡ ì¸¡ì •</h3>
                            <span class="text-3xl">ğŸ’ª</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ì¸¡ì • ì¢…ëª©</span>
                                <span class="text-xl font-bold text-green-600">{{ physical_stats|length|default:"0" }}ê°œ</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì „ì²´ ì°¸ì—¬ìœ¨ ì¹´ë“œ -->
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-lg text-white p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">í‰ê·  ì„±ê³µë¥ </h3>
                            <span class="text-3xl">ğŸ“Š</span>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold">{{ rolling_stats.avg_success_rate|default:"0" }}%</div>
                            <div class="text-sm opacity-90 mt-1">ì•êµ¬ë¥´ê¸° ì„±ê³µë¥ </div>
                        </div>
                    </div>
                </div>

                <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
                {% if rolling_stats.attempt_success_rates %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- íšŒì°¨ë³„ ì„±ê³µë¥  ì°¨íŠ¸ -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">íšŒì°¨ë³„ ì„±ê³µë¥  ì¶”ì´</h3>
                        <div class="chart-container">
                            <canvas id="attemptChart"></canvas>
                        </div>
                    </div>

                    <!-- ë“±ê¸‰ ë¶„í¬ ì°¨íŠ¸ -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">í‰ê°€ ë“±ê¸‰ ë¶„í¬</h3>
                        <div class="chart-container">
                            <canvas id="gradeChart"></canvas>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- í•™ìƒë³„ ìƒì„¸ í…Œì´ë¸” -->
                {% if student_performance %}
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800">í•™ìƒë³„ ì¢…í•© ì„±ê³¼</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">í•™ìƒ</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ì•êµ¬ë¥´ê¸° ì„±ê³µë¥ </th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ì‹œë„ íšŸìˆ˜</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">í‰ê°€ ë“±ê¸‰</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ì‹ ì²´ê¸°ë¡ ì ìˆ˜</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ìµœê·¼ í™œë™</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-100">
                                {% for perf in student_performance %}
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-3">
                                                <span class="text-indigo-600 text-xs font-medium">
                                                    {{ perf.student.user.get_full_name|slice:":1" }}
                                                </span>
                                            </div>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900">{{ perf.student.user.get_full_name }}</div>
                                                <div class="text-sm text-gray-500">{{ perf.student.student_id }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="text-sm font-medium {% if perf.rolling_success_rate >= 80 %}text-green-600{% elif perf.rolling_success_rate >= 60 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                            {{ perf.rolling_success_rate }}%
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center text-sm text-gray-900">
                                        {{ perf.rolling_attempts }}
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        {% if perf.rolling_grade == 'A' %}
                                            <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">ğŸ† ìµœìš°ìˆ˜</span>
                                        {% elif perf.rolling_grade == 'B' %}
                                            <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">ğŸ¥‡ ìš°ìˆ˜</span>
                                        {% elif perf.rolling_grade == 'C' %}
                                            <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">ğŸ¥ˆ ë³´í†µ</span>
                                        {% elif perf.rolling_grade == 'D' %}
                                            <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">ğŸ¥‰ ë…¸ë ¥í•„ìš”</span>
                                        {% else %}
                                            <span class="text-gray-400 text-sm">ë¯¸í‰ê°€</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        {% if perf.physical_score %}
                                            <span class="text-sm font-medium text-gray-900">{{ perf.physical_score }}ì </span>
                                        {% else %}
                                            <span class="text-gray-400 text-sm">-</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 text-center text-sm text-gray-500">
                                        {{ perf.last_activity|date:"m/d"|default:"-" }}
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        {% if perf.is_active %}
                                            <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                                                <i class="fas fa-check-circle mr-1"></i>í™œë™ì¤‘
                                            </span>
                                        {% else %}
                                            <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-600">
                                                <i class="fas fa-clock mr-1"></i>ë¹„í™œë™
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
                
            {% else %}
                <!-- ê°œë³„ í•™ìƒ ë·° -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <!-- ê°œì¸ í†µê³„ ì¹´ë“œ -->
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-lg text-white p-6">
                        <h3 class="text-lg font-semibold mb-4">ì•êµ¬ë¥´ê¸° ì„±ê³¼</h3>
                        <div class="text-center">
                            <div class="text-4xl font-bold mb-2">{{ rolling_stats.success_rate|default:"0" }}%</div>
                            <div class="text-sm opacity-90">ì„±ê³µë¥ </div>
                            <div class="mt-4 pt-4 border-t border-white/20">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <div class="font-semibold">{{ rolling_stats.success_count|default:"0" }}/{{ rolling_stats.total_attempts|default:"0" }}</div>
                                        <div class="opacity-75">ì„±ê³µ/ì „ì²´</div>
                                    </div>
                                    <div>
                                        <div class="font-semibold">{{ rolling_stats.grade|default:"ë¯¸í‰ê°€" }}</div>
                                        <div class="opacity-75">í‰ê°€ë“±ê¸‰</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í™œë™ ìš”ì•½ -->
                    <div class="md:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">í™œë™ ê¸°ë¡ ìš”ì•½</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 bg-indigo-50 rounded-lg">
                                <div class="text-2xl font-bold text-indigo-600">{{ records|length|default:"0" }}</div>
                                <div class="text-sm text-gray-600 mt-1">ì´ í™œë™ ê¸°ë¡</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600">
                                    {% if records %}
                                        {{ records.0.date|date:"m/d" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </div>
                                <div class="text-sm text-gray-600 mt-1">ìµœê·¼ í™œë™ì¼</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìƒì„¸ í™œë™ ê¸°ë¡ -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800">ìƒì„¸ í™œë™ ê¸°ë¡</h3>
                    </div>
                    <div class="max-h-[600px] overflow-y-auto">
                        {% for record in records %}
                        <div class="p-6 border-b border-gray-100 hover:bg-gray-50 transition-colors">
                            <div class="flex items-start">
                                {% if record.type == 'rolling' %}
                                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center mr-4">
                                        <span class="text-indigo-600">ğŸ¤¸</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900">ì•êµ¬ë¥´ê¸° {{ record.attempt_number }}íšŒì°¨</h4>
                                        <p class="text-sm text-gray-500 mt-1">{{ record.date|date:"Yë…„ mì›” dì¼ H:i" }}</p>
                                        <div class="mt-2">
                                            {% if record.is_success %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    <i class="fas fa-check mr-1"></i>ì„±ê³µ
                                                </span>
                                            {% else %}
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                    <i class="fas fa-times mr-1"></i>ì‹¤íŒ¨
                                                </span>
                                            {% endif %}
                                        </div>
                                        {% if record.feedback %}
                                        <p class="text-sm text-gray-600 mt-2 bg-gray-50 p-2 rounded">{{ record.feedback }}</p>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-4">
                                        <span class="text-purple-600">ğŸ’ª</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900">ì‹ ì²´ê¸°ë¡ ì¸¡ì •</h4>
                                        <p class="text-sm text-gray-500 mt-1">{{ record.date|date:"Yë…„ mì›” dì¼ H:i" }}</p>
                                        {% if record.score %}
                                        <p class="text-sm font-medium text-indigo-600 mt-2">ì ìˆ˜: {{ record.score }}ì </p>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="p-12 text-center">
                            <i class="fas fa-clipboard-list text-6xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">ì•„ì§ ê¸°ë¡ëœ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% else %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center">
                <i class="fas fa-chart-bar text-6xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">í•™ê¸‰ ë˜ëŠ” í•™ìƒì„ ì„ íƒí•˜ì—¬ ì‹ ì²´í™œë™ ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”.</p>
            </div>
        {% endif %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// í˜ì´ì§€ ë¡œë“œ ì‹œ ì°¨íŠ¸ ì´ˆê¸°í™”
window.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
});

// ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì°¨íŠ¸ í¬ê¸° ìœ ì§€
let resizeTimer;
window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
        // ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ì§€ ì•ŠìŒ (ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë°©ì§€)
    }, 250);
});

function exportPhysicalData() {
    const filterType = document.querySelector('[name="filter"]').value;
    const filterId = document.querySelector('[name="id"]').value;
    window.location.href = `{% url 'teacher:export_statistics' %}?type=physical&filter=${filterType}&id=${filterId}`;
}

function initializeCharts() {
{% if filter_type == 'class' and rolling_stats.attempt_success_rates %}
// ì°¨íŠ¸ íŒŒê´´ í•¨ìˆ˜ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
function destroyChart(chartId) {
    const existingChart = Chart.getChart(chartId);
    if (existingChart) {
        existingChart.destroy();
    }
}

// ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
destroyChart('attemptChart');
destroyChart('gradeChart');

// íšŒì°¨ë³„ ì„±ê³µë¥  ì°¨íŠ¸
const ctx1 = document.getElementById('attemptChart');
if (ctx1) {
    ctx1.getContext('2d');
    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: [
                {% for stat in rolling_stats.attempt_success_rates %}'{{ stat.attempt }}íšŒì°¨'{% if not forloop.last %},{% endif %}{% endfor %}
            ],
            datasets: [{
                label: 'ì„±ê³µë¥  (%)',
                data: [
                    {% for stat in rolling_stats.attempt_success_rates %}{{ stat.rate }}{% if not forloop.last %},{% endif %}{% endfor %}
                ],
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                tension: 0.3,
                borderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}

// ë“±ê¸‰ ë¶„í¬ ì°¨íŠ¸
const ctx2 = document.getElementById('gradeChart');
if (ctx2) {
    ctx2.getContext('2d');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['ìµœìš°ìˆ˜', 'ìš°ìˆ˜', 'ë³´í†µ', 'ë…¸ë ¥í•„ìš”'],
            datasets: [{
                data: [
                    {{ rolling_stats.grade_distribution.A }},
                    {{ rolling_stats.grade_distribution.B }},
                    {{ rolling_stats.grade_distribution.C }},
                    {{ rolling_stats.grade_distribution.D }}
                ],
                backgroundColor: [
                    '#10b981',
                    '#3b82f6',
                    '#f59e0b',
                    '#ef4444'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15
                    }
                }
            }
        }
    });
}
{% endif %}
}
</script>
{% endblock %}