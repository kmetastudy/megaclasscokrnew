// drag_quiz.js - ì •ë¦¬ëœ ë“œë˜ê·¸ì•¤ë“œë¡­ í€´ì¦ˆ JavaScript
<script>
$(document).ready(function() {
    // Drag í€´ì¦ˆ ì „ìš© ì„¤ì •
    const DRAG_CONFIG = {
        themes: {
            science: {
                keywords: ['ê³¼í•™', 'ì‹¤í—˜', 'í™”í•™', 'ë¬¼ë¦¬', 'ìƒë¬¼', 'ì—°êµ¬', 'ì´ë¡ ', 'ë²•ì¹™', 'ê°€ì„¤', 'ì›ì†Œ', 'ì‹¤í—˜ì‹¤'],
                emojis: ['ğŸ”¬', 'âš—ï¸', 'ğŸ§ª', 'ğŸ”­', 'ğŸŒ¡ï¸', 'âš›ï¸', 'ğŸ§¬', 'ğŸ’Š', 'ğŸ¦ ', 'ğŸŒŒ'],
                particles: ['ğŸ”¬', 'âš—ï¸', 'ğŸ§ª', 'âš›ï¸', 'ğŸ’¡', 'ğŸŒŸ'],
                colors: ['rgba(33, 150, 243, 0.3)', 'rgba(3, 218, 198, 0.3)', 'rgba(0, 188, 212, 0.3)'],
                itemColors: ['#2196F3', '#03DAC6', '#00BCD4', '#4FC3F7', '#0288D1']
            },
            math: {
                keywords: ['ìˆ˜í•™', 'ê³„ì‚°', 'ê³µì‹', 'ë°©ì •ì‹', 'ê¸°í•˜', 'ëŒ€ìˆ˜', 'í™•ë¥ ', 'í†µê³„', 'í•¨ìˆ˜', 'ìˆ«ì'],
                emojis: ['â•', 'â–', 'âœ–ï¸', 'â—', 'ğŸ“', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ”¢', 'âˆ‘', 'âˆ'],
                particles: ['â•', 'â–', 'âœ–ï¸', 'â—', 'ğŸ“', 'ğŸ”¢'],
                colors: ['rgba(255, 152, 0, 0.3)', 'rgba(255, 193, 7, 0.3)', 'rgba(255, 171, 0, 0.3)'],
                itemColors: ['#FF9800', '#FFC107', '#FFAB00', '#FFB74D', '#FF8F00']
            },
            social: {
                keywords: ['ì‚¬íšŒ', 'ì—­ì‚¬', 'ì •ì¹˜', 'ê²½ì œ', 'ë¬¸í™”', 'ì§€ë¦¬', 'ì¸ê¶Œ', 'ë¯¼ì£¼ì£¼ì˜'],
                emojis: ['ğŸ‘¥', 'ğŸ›ï¸', 'ğŸ—³ï¸', 'ğŸ“Š', 'ğŸŒ', 'ğŸ´', 'ğŸ“œ', 'âš–ï¸', 'ğŸ•Šï¸', 'ğŸ¤'],
                particles: ['ğŸ‘¥', 'ğŸ›ï¸', 'ğŸ—³ï¸', 'ğŸŒ', 'ğŸ“Š', 'ğŸ¤'],
                colors: ['rgba(233, 30, 99, 0.3)', 'rgba(255, 64, 129, 0.3)', 'rgba(173, 20, 87, 0.3)'],
                itemColors: ['#E91E63', '#FF4081', '#AD1457', '#F06292', '#C2185B']
            },
            career: {
                keywords: ['ì§„ë¡œ', 'ì§ì—…', 'ì·¨ì—…', 'ë¯¸ë˜', 'ê¿ˆ', 'ëª©í‘œ', 'ê³„íš', 'ì„±ì¥', 'ë°œì „'],
                emojis: ['ğŸ’¼', 'ğŸ‘”', 'ğŸ¯', 'ğŸ“ˆ', 'ğŸ†', 'ğŸš€', 'ğŸ’¡', 'ğŸŒŸ', 'ğŸ”¥', 'â­'],
                particles: ['ğŸ’¼', 'ğŸ¯', 'ğŸ“ˆ', 'ğŸ†', 'ğŸš€', 'ğŸ’¡'],
                colors: ['rgba(76, 175, 80, 0.3)', 'rgba(139, 195, 74, 0.3)', 'rgba(102, 187, 106, 0.3)'],
                itemColors: ['#4CAF50', '#8BC34A', '#66BB6A', '#81C784', '#388E3C']
            },
            cooking: {
                keywords: ['ìš”ë¦¬', 'ìŒì‹', 'ë ˆì‹œí”¼', 'ì¬ë£Œ', 'ì¡°ë¦¬', 'ë§›', 'ì˜ì–‘', 'ê±´ê°•ì‹í’ˆ'],
                emojis: ['ğŸ³', 'ğŸ‘¨â€ğŸ³', 'ğŸ¥„', 'ğŸ½ï¸', 'ğŸ”¥', 'ğŸ¥—', 'ğŸ²', 'ğŸ§„', 'ğŸŒ¶ï¸', 'ğŸ…'],
                particles: ['ğŸ³', 'ğŸ‘¨â€ğŸ³', 'ğŸ¥„', 'ğŸ”¥', 'ğŸ¥—', 'ğŸ²'],
                colors: ['rgba(244, 67, 54, 0.3)', 'rgba(255, 87, 34, 0.3)', 'rgba(229, 115, 115, 0.3)'],
                itemColors: ['#F44336', '#FF5722', '#E57373', '#EF5350', '#D32F2F']
            },
            default: {
                keywords: [],
                emojis: ['ğŸ¯', 'âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ‰', 'ğŸŠ', 'ğŸŒˆ', 'ğŸ¦‹', 'ğŸŒº'],
                particles: ['ğŸ¯', 'âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ‰'],
                colors: ['rgba(255, 255, 255, 0.3)', 'rgba(255, 107, 107, 0.3)', 'rgba(78, 205, 196, 0.3)'],
                itemColors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#B794F6']
            }
        },
        
        correctMessages: [
            "ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘ ë“œë˜ê·¸ ì‹¤ë ¥ì´ ëŒ€ë‹¨í•´ìš”!",
            "ì™„ë²½í•´ìš”! ğŸŒŸ í›Œë¥­í•œ ë“œë˜ê·¸ì•¤ë“œë¡­ì´ì—ˆìŠµë‹ˆë‹¤!",
            "ë§ìŠµë‹ˆë‹¤! ğŸŠ ì •í™•í•œ ìœ„ì¹˜ì— ë°°ì¹˜í–ˆì–´ìš”!",
            "ì •ë‹µì´ì—ìš”! ğŸ’¯ ìµœê³ ì˜ ë“œë˜ê·¸ ì†œì”¨ì˜ˆìš”!",
            "ë¸Œë¼ë³´! ğŸ­ ë©‹ì§„ ë“œë˜ê·¸ í…Œí¬ë‹‰ì´ì—ˆìŠµë‹ˆë‹¤!"
        ],
        
        incorrectMessages: [
            "ğŸ¤” ì•„ì§ ì •ë‹µì´ ì•„ë‹ˆì—ìš”! ë‹¤ì‹œ ë“œë˜ê·¸í•´ë³´ì„¸ìš”! ğŸ˜Š",
            "ê´œì°®ì•„ìš”! ğŸ’ª í•œ ë²ˆ ë” ë„ì „í•´ë³´ì„¸ìš”!",
            "ì¡°ê¸ˆ ë” ìƒê°í•´ë³¼ê¹Œìš”? ğŸ§ ë‹¤ì‹œ ë°°ì¹˜í•´ë³´ì„¸ìš”!",
            "ì•„ì‰¬ì›Œìš”! ğŸ˜Š ë‹¤ì‹œ í•œë²ˆ ë“œë˜ê·¸í•´ë³´ì„¸ìš”!",
            "í˜ë‚´ì„¸ìš”! ğŸŒŸ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!"
        ]
    };
    
    let dragIsAnswered = false;
    let currentState = {};
    let draggedItem = null;
    let touchItem = null;
    let extractedItems = [];
    let questionText = '';
    let quizType = 'fill-blank'; // ê¸°ë³¸ê°’
    
    // Drag í€´ì¦ˆ ì´ˆê¸°í™”
    function initializeDragQuiz() {
        if ($('#drag-quiz-container').length === 0) return;
        
        console.log('Drag í€´ì¦ˆ ì´ˆê¸°í™” ì‹œì‘');
        
        // ê¸°ì¡´ HTMLì—ì„œ ë¬¸ì œì™€ ë“œë˜ê·¸ ì•„ì´í…œ ì¶”ì¶œ
        extractQuestionAndItems();
        
        // ë¬¸ì œ í…ìŠ¤íŠ¸ ë¶„ì„í•˜ì—¬ í…Œë§ˆ ì„¤ì •
        const theme = detectThemeFromText(questionText);
        applyDragTheme(theme);
        
        // íŒŒí‹°í´ ìƒì„±
        createDragParticles(theme);
        
        // í€´ì¦ˆ íƒ€ì…ì— ë”°ë¼ ì´ˆê¸°í™”
        switch(quizType) {
            case 'fill-blank':
                initializeFillBlank();
                break;
            case 'sort':
                initializeSort();
                break;
            case 'match':
                initializeMatch();
                break;
            default:
                initializeFillBlank();
        }
        
        // ê¸°ì¡´ ë‹µì•ˆ ë³µì›
        restoreDragAnswer();
        
        console.log('Drag í€´ì¦ˆ ì´ˆê¸°í™” ì™„ë£Œ');
    }
    
    // ê¸°ì¡´ HTMLì—ì„œ ë¬¸ì œì™€ ì•„ì´í…œ ì¶”ì¶œ
    function extractQuestionAndItems() {
        // ë¬¸ì œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
        const questionSelectors = [
            '.quiz-container .question-text',
            '.quiz-container h1',
            '.question-box h1',
            '.question-text'
        ];
        
        for (let selector of questionSelectors) {
            const element = $(selector);
            if (element.length > 0 && element.text().trim()) {
                questionText = element.text().trim();
                break;
            }
        }
        
        // ë“œë˜ê·¸ ì•„ì´í…œ ì¶”ì¶œ
        extractedItems = [];
        $('.options-container .option-button').each(function(index) {
            const itemText = $(this).find('.option-text').text().trim();
            const dataClicked = $(this).attr('data-clicked');
            
            if (itemText) {
                extractedItems.push({
                    id: `item${index + 1}`,
                    text: itemText,
                    value: dataClicked || (index + 1).toString(),
                    correct: true
                });
            }
        });
        
        // ë“œë¡­ì¡´ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ í€´ì¦ˆ íƒ€ì… ê²°ì •
        if (questionText.includes('<drop-zone') || questionText.includes('ë¹ˆì¹¸')) {
            quizType = 'fill-blank';
        } else if (questionText.includes('ìˆœì„œ') || questionText.includes('ì •ë ¬')) {
            quizType = 'sort';
        } else if (questionText.includes('ì—°ê²°') || questionText.includes('ë§¤ì¹­')) {
            quizType = 'match';
        }
        
        // ìƒˆë¡œìš´ ë¬¸ì œ ë°•ìŠ¤ì— í…ìŠ¤íŠ¸ ì„¤ì •
        $('#question-text').text(questionText || "ë“œë˜ê·¸ì•¤ë“œë¡­ ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”!");
        
        console.log('ì¶”ì¶œëœ ë¬¸ì œ:', questionText);
        console.log('ì¶”ì¶œëœ ì•„ì´í…œ:', extractedItems);
        console.log('í€´ì¦ˆ íƒ€ì…:', quizType);
    }
    
    // ë¬¸ì œ í…ìŠ¤íŠ¸ì—ì„œ í…Œë§ˆ ê°ì§€
    function detectThemeFromText(text) {
        let maxScore = 0;
        let detectedTheme = 'default';
        
        Object.keys(DRAG_CONFIG.themes).forEach(theme => {
            const keywords = DRAG_CONFIG.themes[theme].keywords;
            let score = 0;
            
            keywords.forEach(keyword => {
                if (text.includes(keyword)) {
                    score++;
                }
            });
            
            if (score > maxScore) {
                maxScore = score;
                detectedTheme = theme;
            }
        });
        
        console.log(`í…Œë§ˆ ê°ì§€: ${detectedTheme} (ì ìˆ˜: ${maxScore})`);
        return detectedTheme;
    }
    
    // Drag í…Œë§ˆ ì ìš©
    function applyDragTheme(theme) {
        const container = $('#drag-quiz-container');
        container.attr('data-theme', theme);
        
        if (DRAG_CONFIG.themes[theme]) {
            const themeConfig = DRAG_CONFIG.themes[theme];
            
            // ì¥ì‹ ì´ëª¨ì§€ ì„¤ì •
            $('#decoration1').text(themeConfig.emojis[0] || 'ğŸ¯');
            $('#decoration2').text(themeConfig.emojis[Math.floor(Math.random() * themeConfig.emojis.length)] || 'âœ¨');
        }
        
        // í€´ì¦ˆ ì œëª© ì„¤ì •
        const themeNames = {
            science: 'ê³¼í•™',
            math: 'ìˆ˜í•™',
            social: 'ì‚¬íšŒ',
            career: 'ì§„ë¡œ',
            cooking: 'ìš”ë¦¬',
            default: 'ì¼ë°˜'
        };
        $('#quiz-title').text(`${themeNames[theme] || 'ì¼ë°˜'} ë“œë˜ê·¸ì•¤ë“œë¡­ í€´ì¦ˆ`);
    }
    
    // Drag íŒŒí‹°í´ ìƒì„±
    function createDragParticles(theme) {
        const particleContainer = $('#particles');
        const themeConfig = DRAG_CONFIG.themes[theme];
        
        if (!themeConfig) return;
        
        particleContainer.empty();
        
        for (let i = 0; i < 15; i++) {
            const particle = $('<div>').addClass('particle');
            particle.css({
                'left': Math.random() * 100 + '%',
                'width': Math.random() * 8 + 4 + 'px',
                'height': Math.random() * 8 + 4 + 'px',
                'background-color': themeConfig.colors[Math.floor(Math.random() * themeConfig.colors.length)],
                'animation-delay': Math.random() * 15 + 's',
                'animation-duration': (Math.random() * 10 + 15) + 's'
            });
            
            // 30% í™•ë¥ ë¡œ í…Œë§ˆë³„ ì´ëª¨ì§€ íŒŒí‹°í´
            if (Math.random() < 0.3 && themeConfig.particles) {
                particle.text(themeConfig.particles[Math.floor(Math.random() * themeConfig.particles.length)]);
                particle.css({
                    'background-color': 'transparent',
                    'font-size': '20px',
                    'width': 'auto',
                    'height': 'auto'
                });
            }
            
            particleContainer.append(particle);
        }
    }
    
    // ë¹ˆì¹¸ì±„ìš°ê¸° ì´ˆê¸°í™”
    function initializeFillBlank() {
        const questionElement = $('#question-text');
        let questionHTML = questionText;
        
        // drop-zone íƒœê·¸ë¥¼ ì‹¤ì œ ë“œë¡­ì¡´ìœ¼ë¡œ ë³€í™˜
        questionHTML = questionHTML.replace(/<drop-zone[^>]*id=['"]([^'"]*)['"][^>]*><\/drop-zone>/g, 
            '<span class="drop-zone" data-zone-id="$1">ë¹ˆì¹¸</span>');
        
        // ì¼ë°˜ì ì¸ ë¹ˆì¹¸ í‘œì‹œë„ ë“œë¡­ì¡´ìœ¼ë¡œ ë³€í™˜
        questionHTML = questionHTML.replace(/____+/g, '<span class="drop-zone" data-zone-id="blank1">ë¹ˆì¹¸</span>');
        questionHTML = questionHTML.replace(/\[ë¹ˆì¹¸\]/g, '<span class="drop-zone" data-zone-id="blank1">ë¹ˆì¹¸</span>');
        
        questionElement.html(questionHTML);
        
        // ë“œë¡­ì¡´ ì´ë²¤íŠ¸ ì„¤ì •
        setupDropZones();
        
        // ë“œë˜ê·¸ ì•„ì´í…œ ìƒì„±
        createDragItems();
    }
    
    // ì •ë ¬í˜• ì´ˆê¸°í™”
    function initializeSort() {
        $('#question-text').html(questionText);
        $('#sort-container').show();
        
        // ì •ë ¬ ì˜ì—­ ìƒì„±
        const sortContainer = $('#sort-container');
        for (let i = 1; i <= extractedItems.length; i++) {
            const zoneElement = $('<div>')
                .addClass('sort-zone')
                .attr('id', `sort${i}`)
                .attr('data-order', i)
                .html(`<div class="zone-label">${i}ë²ˆì§¸</div>`);
            
            sortContainer.append(zoneElement);
        }
        
        setupSortZones();
        createDragItems();
    }
    
    // ë§¤ì¹­í˜• ì´ˆê¸°í™”
    function initializeMatch() {
        $('#question-text').html(questionText);
        $('#match-container').show();
        
        const matchContainer = $('#match-container');
        extractedItems.forEach((item, index) => {
            const rowElement = $('<div>')
                .addClass('match-row')
                .html(`
                    <div class="match-left">í•­ëª© ${index + 1}</div>
                    <div class="match-arrow">â†’</div>
                    <div class="match-right drop-zone" data-match-id="match${index + 1}">ì„ íƒí•˜ì„¸ìš”</div>
                `);
            matchContainer.append(rowElement);
        });
        
        setupDropZones();
        createDragItems();
    }
    
    // ë“œë˜ê·¸ ì•„ì´í…œ ìƒì„± (í†µí•©ëœ ë²„ì „)
    function createDragItems() {
        const container = $('#drag-container');
        const theme = $('#drag-quiz-container').attr('data-theme') || 'default';
        const themeConfig = DRAG_CONFIG.themes[theme];
        
        container.empty();
        
        extractedItems.forEach((item, index) => {
            const itemElement = $('<div>')
                .addClass('drag-item')
                .attr('id', item.id)
                .attr('draggable', 'true')
                .attr('data-value', item.value)
                .attr('tabindex', '0') // í‚¤ë³´ë“œ ì ‘ê·¼ì„±
                .attr('role', 'button') // ì ‘ê·¼ì„±
                .attr('aria-label', `ë“œë˜ê·¸ ê°€ëŠ¥í•œ ì•„ì´í…œ: ${item.text}`) // ì ‘ê·¼ì„±
                .text(item.text)
                .css({
                    'background': `linear-gradient(135deg, ${themeConfig.itemColors[index % themeConfig.itemColors.length]}, ${adjustBrightness(themeConfig.itemColors[index % themeConfig.itemColors.length], 20)})`
                });
            
            // ì´ë²¤íŠ¸ ë°”ì¸ë”© (í†µí•©ëœ ë²„ì „)
            itemElement.on('dragstart', handleDragStart);
            itemElement.on('dragend', handleDragEnd);
            itemElement.on('touchstart', handleTouchStart);
            itemElement.on('touchmove', handleTouchMove);
            itemElement.on('touchend', handleTouchEnd);
            
            container.append(itemElement);
            
            console.log('ë“œë˜ê·¸ ì•„ì´í…œ ìƒì„±:', item.text);
        });
        
        // í‚¤ë³´ë“œ ì§€ì› ì„¤ì •
        setupKeyboardSupport();
    }
    
    // ë“œë¡­ì¡´ ì„¤ì •
    function setupDropZones() {
        $(document).on('dragover', '.drop-zone', handleDragOver);
        $(document).on('drop', '.drop-zone', handleDrop);
        $(document).on('dragenter', '.drop-zone', handleDragEnter);
        $(document).on('dragleave', '.drop-zone', handleDragLeave);
    }
    
    // ì •ë ¬ì¡´ ì„¤ì •
    function setupSortZones() {
        $(document).on('dragover', '.sort-zone', handleDragOver);
        $(document).on('drop', '.sort-zone', handleSortDrop);
        $(document).on('dragenter', '.sort-zone', handleDragEnter);
        $(document).on('dragleave', '.sort-zone', handleDragLeave);
    }
    
    // í†µí•©ëœ ë“œë˜ê·¸ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
    function handleDragStart(e) {
        draggedItem = this;
        
        // ëª¨ë“  ì•„ì´í…œì˜ ì„ íƒ ìƒíƒœ ì œê±°
        $('.drag-item').removeClass('selected dragging');
        
        // í˜„ì¬ ì•„ì´í…œì„ ì„ íƒ ìƒíƒœë¡œ í‘œì‹œ
        $(this).addClass('selected');
        
        console.log('ë“œë˜ê·¸ ì‹œì‘:', $(this).text());
        
        // ì•½ê°„ì˜ ì§€ì—° í›„ ë“œë˜ê·¸ ìƒíƒœë¡œ ì „í™˜
        setTimeout(() => {
            $(this).removeClass('selected').addClass('dragging');
        }, 200);
        
        e.originalEvent.dataTransfer.setData('text/plain', this.id);
        
        // ì‹œê°ì  í”¼ë“œë°± ì‚¬ìš´ë“œ íš¨ê³¼
        playDragSound('start');
    }
    
    function handleDragEnd(e) {
        // ëª¨ë“  ë“œë˜ê·¸ ê´€ë ¨ í´ë˜ìŠ¤ ì œê±°
        $(this).removeClass('dragging selected');
        
        console.log('ë“œë˜ê·¸ ì¢…ë£Œ:', $(this).text());
        
        // í”¼ë“œë°± ì‚¬ìš´ë“œ íš¨ê³¼
        playDragSound('end');
    }
    
    function handleDragOver(e) {
        e.preventDefault();
    }
    
    function handleDragEnter(e) {
        e.preventDefault();
        $(this).addClass('highlight');
        
        // ë“œë¡­ì¡´ ì§„ì… íš¨ê³¼
        $(this).css('transform', 'scale(1.1)');
        
        console.log('ë“œë¡­ì¡´ ì§„ì…:', $(this).attr('data-zone-id') || $(this).attr('data-order'));
    }
    
    function handleDragLeave(e) {
        $(this).removeClass('highlight');
        $(this).css('transform', '');
        
        console.log('ë“œë¡­ì¡´ ë²—ì–´ë‚¨');
    }
    
    // ë“œë¡­ ì²˜ë¦¬ (ê°œì„ ëœ ë²„ì „)
    function handleDrop(e) {
        e.preventDefault();
        $(this).removeClass('highlight');
        
        if (dragIsAnswered) return;
        
        const itemId = e.originalEvent.dataTransfer.getData('text/plain');
        const item = $('#' + itemId);
        const zoneId = $(this).attr('data-zone-id') || $(this).attr('data-match-id') || 'zone1';
        
        console.log('ë“œë¡­ ì„±ê³µ:', item.text(), 'â†’', zoneId);
        
        // ê¸°ì¡´ ì•„ì´í…œì´ ìˆë‹¤ë©´ ë³µì›
        if ($(this).attr('data-filled-by')) {
            const existingItem = $('#' + $(this).attr('data-filled-by'));
            if (existingItem.length) {
                existingItem.removeClass('placed').show();
                console.log('ê¸°ì¡´ ì•„ì´í…œ ë³µì›:', existingItem.text());
            }
        }
        
        // ì„±ê³µ í”¼ë“œë°± íš¨ê³¼
        $(this).addClass('drop-success');
        setTimeout(() => {
            $(this).removeClass('drop-success');
        }, 1000);
        
        // ìƒˆ ì•„ì´í…œ ë°°ì¹˜
        $(this).text(item.text()).addClass('filled').attr('data-filled-by', itemId);
        item.addClass('placed').hide();
        
        // ìƒíƒœ ì €ì¥
        currentState[zoneId] = item.attr('data-value') || itemId;
        
        console.log('í˜„ì¬ ìƒíƒœ:', currentState);
        
        // ì™„ë£Œ í™•ì¸
        setTimeout(() => checkCompletion(), 300);
        
        // ë“œë¡­ ì„±ê³µì‹œ ì§„ë™ í”¼ë“œë°±
        if (navigator.vibrate) {
            navigator.vibrate([50, 50, 50]); // ì„±ê³µ íŒ¨í„´
        }
        
        // í”¼ë“œë°± ì‚¬ìš´ë“œ íš¨ê³¼
        playDragSound('success');
    }
    
    // ì •ë ¬ ë“œë¡­ ì²˜ë¦¬
    function handleSortDrop(e) {
        e.preventDefault();
        $(this).removeClass('highlight');
        
        if (dragIsAnswered) return;
        
        const itemId = e.originalEvent.dataTransfer.getData('text/plain');
        const item = $('#' + itemId);
        const zoneOrder = $(this).attr('data-order');
        
        // ê¸°ì¡´ ì•„ì´í…œ ì œê±°
        const existingItem = $(this).find('.drag-item');
        if (existingItem.length) {
            const existingId = existingItem.attr('id').replace('placed-', '');
            $('#' + existingId).removeClass('placed').show();
            existingItem.remove();
        }
        
        // ìƒˆ ì•„ì´í…œ ë°°ì¹˜
        const clonedItem = item.clone()
            .attr('id', 'placed-' + itemId)
            .attr('draggable', 'false')
            .removeClass('dragging')
            .css({
                'margin': '0',
                'width': '100%',
                'height': 'auto'
            });
        
        $(this).append(clonedItem).addClass('filled');
        item.addClass('placed').hide();
        
        // ìƒíƒœ ì €ì¥
        currentState[zoneOrder] = item.attr('data-value') || itemId;
        
        // ì™„ë£Œ í™•ì¸
        setTimeout(() => checkCompletion(), 300);
    }
    
    // í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ê°œì„ ëœ ë²„ì „)
    function handleTouchStart(e) {
        if (dragIsAnswered) return;
        
        touchItem = this;
        
        // ëª¨ë“  ì•„ì´í…œì˜ ì„ íƒ ìƒíƒœ ì œê±°
        $('.drag-item').removeClass('selected dragging');
        
        // í˜„ì¬ ì•„ì´í…œì„ ì„ íƒ ìƒíƒœë¡œ í‘œì‹œ
        $(this).addClass('selected');
        
        console.log('í„°ì¹˜ ë“œë˜ê·¸ ì‹œì‘:', $(this).text());
        
        // í„°ì¹˜ ì§„ë™ í”¼ë“œë°± (ì§€ì›í•˜ëŠ” ê¸°ê¸°ì—ì„œ)
        if (navigator.vibrate) {
            navigator.vibrate(50);
        }
        
        // ì•½ê°„ì˜ ì§€ì—° í›„ ë“œë˜ê·¸ ìƒíƒœë¡œ ì „í™˜
        setTimeout(() => {
            $(this).removeClass('selected').addClass('dragging');
        }, 150);
        
        e.preventDefault();
    }
    
    function handleTouchMove(e) {
        if (!touchItem) return;
        e.preventDefault();
        
        const touch = e.originalEvent.touches[0];
        
        // ë“œë˜ê·¸ ì¤‘ì¸ ì•„ì´í…œì˜ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        $(touchItem).css({
            'position': 'fixed',
            'left': touch.clientX - 60 + 'px',
            'top': touch.clientY - 30 + 'px',
            'z-index': '1000',
            'pointer-events': 'none' // í„°ì¹˜ ì¶©ëŒ ë°©ì§€
        });
        
        // ë“œë¡­ì¡´ í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
        const element = document.elementFromPoint(touch.clientX, touch.clientY);
        $('.drop-zone, .sort-zone').removeClass('highlight');
        
        if (element && ($(element).hasClass('drop-zone') || $(element).hasClass('sort-zone'))) {
            $(element).addClass('highlight');
            
            // ë“œë¡­ì¡´ ì§„ì…ì‹œ ì§„ë™ í”¼ë“œë°±
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
        }
    }
    
    function handleTouchEnd(e) {
        if (!touchItem) return;
        
        const touch = e.originalEvent.changedTouches[0];
        const element = document.elementFromPoint(touch.clientX, touch.clientY);
        
        // ìŠ¤íƒ€ì¼ ë³µì›
        $(touchItem).css({
            'position': '',
            'left': '',
            'top': '',
            'z-index': '',
            'pointer-events': ''
        }).removeClass('dragging selected');
        
        console.log('í„°ì¹˜ ë“œë˜ê·¸ ì¢…ë£Œ:', $(touchItem).text());
        
        // ë“œë¡­ ì„±ê³µì‹œ ì§„ë™ í”¼ë“œë°±
        if (element && ($(element).hasClass('drop-zone') || $(element).hasClass('sort-zone'))) {
            if (navigator.vibrate) {
                navigator.vibrate([50, 50, 50]); // ì„±ê³µ íŒ¨í„´
            }
            
            // ë“œë¡­ ì²˜ë¦¬
            if ($(element).hasClass('drop-zone')) {
                const fakeEvent = {
                    preventDefault: () => {},
                    originalEvent: {
                        dataTransfer: {
                            getData: () => touchItem.id
                        }
                    }
                };
                handleDrop.call(element, fakeEvent);
            } else if ($(element).hasClass('sort-zone')) {
                const fakeEvent = {
                    preventDefault: () => {},
                    originalEvent: {
                        dataTransfer: {
                            getData: () => touchItem.id
                        }
                    }
                };
                handleSortDrop.call(element, fakeEvent);
            }
        }
        
        // í•˜ì´ë¼ì´íŠ¸ ì œê±°
        $('.drop-zone, .sort-zone').removeClass('highlight');
        touchItem = null;
    }
    
    // í‚¤ë³´ë“œ ì ‘ê·¼ì„± ì§€ì›
    function setupKeyboardSupport() {
        $(document).on('keydown', '.drag-item', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                
                // í‚¤ë³´ë“œë¡œ ì•„ì´í…œ ì„ íƒ
                $('.drag-item').removeClass('selected');
                $(this).addClass('selected');
                
                console.log('í‚¤ë³´ë“œë¡œ ì„ íƒ:', $(this).text());
                
                // 2ì´ˆ í›„ ì„ íƒ í•´ì œ
                setTimeout(() => {
                    $(this).removeClass('selected');
                }, 2000);
            }
        });
    }
    
    // ì™„ë£Œ í™•ì¸
    function checkCompletion() {
        if (dragIsAnswered) return;
        
        let requiredCount = 0;
        let completedCount = Object.keys(currentState).length;
        
        if (quizType === 'sort') {
            requiredCount = extractedItems.length;
        } else if (quizType === 'match') {
            requiredCount = extractedItems.length;
        } else {
            // fill-blank
            requiredCount = $('.drop-zone').length;
        }
        
        // ëª¨ë“  í•„ìˆ˜ ì˜ì—­ì´ ì±„ì›Œì¡Œìœ¼ë©´ ìë™ ì±„ì 
        if (completedCount >= requiredCount) {
            checkAnswers();
        }
    }
    
    // ë‹µì•ˆ ì±„ì 
    function checkAnswers() {
        if (dragIsAnswered) return;
        
        dragIsAnswered = true;
        
        console.log('ë“œë˜ê·¸ ë‹µì•ˆ ì±„ì  ì‹œì‘:', currentState);
        
        // ì„œë²„ë¡œ ë‹µì•ˆ ì „ì†¡
        const qid = $('.submit-button, .resubmit-button').first().attr('data-qid') || '{{ slide.content.id }}';
        const slideId = '{{ slide.id }}';
        
        $.ajax({
            url: '{% url "student:check_answer" %}',
            type: 'POST',
            data: {
                'content_id': qid,
                'slide_id': slideId,
                'student_answer': JSON.stringify(currentState),
                'quiz_type': quizType,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                console.log('ì±„ì  ê²°ê³¼:', response);
                handleDragResult(response);
            },
            error: function() {
                showDragToast('ì±„ì  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                resetDragQuiz();
            }
        });
    }
    
    // Drag ê²°ê³¼ ì²˜ë¦¬
    function handleDragResult(response) {
        console.log('ê²°ê³¼ ì²˜ë¦¬:', response);
        
        // ë“œë¡­ì¡´ ìƒíƒœ í‘œì‹œ
        $('.drop-zone, .sort-zone').each(function() {
            const zoneId = $(this).attr('data-zone-id') || $(this).attr('data-match-id') || $(this).attr('data-order');
            if (zoneId && currentState[zoneId]) {
                if (response.is_correct) {
                    $(this).addClass('correct');
                } else {
                    $(this).addClass('incorrect');
                }
            }
        });
        
        setTimeout(() => {
            if (response.is_correct) {
                // ì •ë‹µ ì²˜ë¦¬
                showDragToast(getRandomMessage(DRAG_CONFIG.correctMessages), 'success');
                showDragAnimation('correct');
                showDragFeedback('correct', getRandomMessage(DRAG_CONFIG.correctMessages));
                
                // ì œì¶œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                $('#submit-btn, #resubmit-btn').hide();
                
                console.log('âœ… ì •ë‹µ ì²˜ë¦¬ ì™„ë£Œ');
                
            } else {
                // ì˜¤ë‹µ ì²˜ë¦¬
                showDragToast(getRandomMessage(DRAG_CONFIG.incorrectMessages), 'error');
                showDragAnimation('incorrect');
                showDragFeedback('incorrect', getRandomMessage(DRAG_CONFIG.incorrectMessages));
                
                // ì¬ì œì¶œ ë²„íŠ¼ í‘œì‹œ
                $('#submit-btn').hide();
                $('#resubmit-btn').show();
                
                console.log('âŒ ì˜¤ë‹µ ì²˜ë¦¬ ì™„ë£Œ');
            }
        }, 300);
        
        // ì œì¶œ ìƒíƒœ ì—…ë°ì´íŠ¸
        updateDragSubmissionStatus(response);
        
        // 8ì´ˆ í›„ UI ì •ë¦¬ (ì˜¤ë‹µì¸ ê²½ìš° ì¬ì‹œë„ ê°€ëŠ¥)
        setTimeout(() => {
            if (!response.is_correct) {
                resetDragQuizForRetry();
            }
        }, 8000);
    }
    
    // í”¼ë“œë°± í‘œì‹œ í•¨ìˆ˜
    function showDragFeedback(type, message) {
        const feedbackElement = $(`#feedback-${type}`);
        feedbackElement.html(message);
        feedbackElement.addClass('show');
        
        // ì„œë²„ ìƒíƒœ ë©”ì‹œì§€ ì¶”ê°€
        setTimeout(() => {
            const statusElement = $('<div>').addClass('server-status');
            statusElement.html('ğŸ“¡ ì„œë²„ë¡œ ê²°ê³¼ ì „ì†¡ ì¤‘...');
            feedbackElement.append(statusElement);
            
            // ì „ì†¡ ì™„ë£Œ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                statusElement.html('âœ… ì „ì†¡ ì™„ë£Œ!');
                statusElement.css({
                    'background-color': 'rgba(76, 175, 80, 0.9)',
                    'color': 'white',
                    'border-color': '#4CAF50'
                });
            }, 1500);
        }, 1000);
    }
    
    // Drag ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
    function showDragAnimation(type) {
        const container = $('#animation-container');
        
        if (type === 'correct') {
            // ì •ë‹µ ì• ë‹ˆë©”ì´ì…˜
            const animations = [createFireworks, createDragStorm, createStarExplosion];
            const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
            randomAnimation();
        } else {
            // ì˜¤ë‹µ ì• ë‹ˆë©”ì´ì…˜
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const element = $('<div>').addClass('animated-element');
                    element.text(['ğŸ’­', 'ğŸ¤”', 'ğŸ˜…', 'ğŸ’ª'][Math.floor(Math.random() * 4)]);
                    element.css({
                        'left': Math.random() * 100 + '%',
                        'animation-delay': Math.random() * 500 + 'ms'
                    });
                    
                    container.append(element);
                    
                    setTimeout(() => {
                        element.remove();
                    }, 4000);
                }, i * 100);
            }
        }
    }
    
    // ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ë“¤
    function createDragStorm() {
        const container = $('#animation-container');
        const dragEmojis = ['ğŸ‘†', 'â˜ï¸', 'ğŸ‘‡', 'ğŸ‘ˆ', 'ğŸ‘‰', 'ğŸ¤', 'ğŸ–±ï¸'];
        
        for (let i = 0; i < 20; i++) {
            setTimeout(() => {
                const drag = $('<div>').addClass('animated-element');
                drag.text(dragEmojis[Math.floor(Math.random() * dragEmojis.length)]);
                drag.css({
                    'left': Math.random() * 100 + '%',
                    'animation-delay': Math.random() * 400 + 'ms'
                });
                
                container.append(drag);
                
                setTimeout(() => {
                    drag.remove();
                }, 3500);
            }, i * 120);
        }
    }
    
    function createFireworks() {
        const container = $('#animation-container');
        
        for (let i = 0; i < 3; i++) {
            setTimeout(() => {
                const centerX = Math.random() * window.innerWidth;
                const centerY = Math.random() * (window.innerHeight * 0.6) + window.innerHeight * 0.2;
                
                for (let j = 0; j < 8; j++) {
                    const particle = $('<div>');
                    particle.text('âœ¨');
                    particle.css({
                        'position': 'absolute',
                        'font-size': window.innerWidth < 768 ? '20px' : '30px',
                        'left': centerX + 'px',
                        'top': centerY + 'px',
                        'transition': 'all 1.2s cubic-bezier(0.4, 0, 0.2, 1)',
                        'pointer-events': 'none'
                    });
                    
                    const angle = (j / 8) * 2 * Math.PI;
                    const distance = window.innerWidth < 768 ? 100 : 150;
                    const endX = centerX + Math.cos(angle) * distance;
                    const endY = centerY + Math.sin(angle) * distance;
                    
                    container.append(particle);
                    
                    setTimeout(() => {
                        particle.css({
                            'left': endX + 'px',
                            'top': endY + 'px',
                            'opacity': '0',
                            'transform': 'scale(1.5)'
                        });
                    }, 10);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 1200);
                }
            }, i * 400);
        }
    }
    
    function createStarExplosion() {
        const container = $('#animation-container');
        const stars = ['â­', 'ğŸŒŸ', 'âœ¨', 'ğŸ’«'];
        
        for (let i = 0; i < 25; i++) {
            const star = $('<div>').addClass('animated-element');
            star.text(stars[Math.floor(Math.random() * stars.length)]);
            star.css({
                'left': Math.random() * 100 + '%',
                'animation-delay': Math.random() * 800 + 'ms'
            });
            
            container.append(star);
            
            setTimeout(() => {
                star.remove();
            }, 3500);
        }
    }
    
    // Drag ê¸°ì¡´ ë‹µì•ˆ ë³µì›
    function restoreDragAnswer() {
        // í…œí”Œë¦¿ ë³€ìˆ˜ëŠ” ì‹¤ì œ êµ¬í˜„ì‹œ ì„œë²„ì—ì„œ ì „ë‹¬ëœ ê°’ìœ¼ë¡œ ëŒ€ì²´ë˜ì–´ì•¼ í•¨
        {% if existing_answer and slide.content_type.type_name == 'drag' %}
        try {
            const rawAnswerString = '{{ existing_answer.answer|escapejs|default:"{}" }}';
            console.log('=== Drag ê¸°ì¡´ ë‹µì•ˆ ë³µì› ===');
            console.log('Raw Answer:', rawAnswerString);
            
            const cleanedJsonString = rawAnswerString
                .replace(/\bTrue\b/g, 'true')
                .replace(/\bFalse\b/g, 'false')
                .replace(/\bNone\b/g, 'null')
                .replace(/'/g, '"');
            
            const answerData = JSON.parse(cleanedJsonString);
            console.log('Parsed Answer:', answerData);
            
            if (answerData.selected_answer) {
                currentState = answerData.selected_answer;
                dragIsAnswered = true;
                
                // ìƒíƒœ ë³µì›
                Object.keys(currentState).forEach(zoneId => {
                    const itemValue = currentState[zoneId];
                    const zone = $(`.drop-zone[data-zone-id="${zoneId}"], .sort-zone[data-order="${zoneId}"], .drop-zone[data-match-id="${zoneId}"]`);
                    const item = $(`.drag-item[data-value="${itemValue}"]`);
                    
                    if (zone.length && item.length) {
                        zone.text(item.text()).addClass('filled').attr('data-filled-by', item.attr('id'));
                        item.addClass('placed').hide();
                    }
                });
                
                setTimeout(() => {
                    {% if is_already_correct %}
                        // ì •ë‹µì¸ ê²½ìš°
                        $('.drop-zone.filled, .sort-zone.filled').addClass('correct');
                        $('#submit-btn, #resubmit-btn').hide();
                        showDragFeedback('correct', 'ğŸ‰ ì´ì „ ì œì¶œ: ì •ë‹µì…ë‹ˆë‹¤! ì˜í–ˆì–´ìš”!');
                        
                        console.log('âœ… ì •ë‹µ ìƒíƒœë¡œ ë³µì› ì™„ë£Œ');
                    {% else %}
                        // ì˜¤ë‹µì¸ ê²½ìš°
                        $('.drop-zone.filled, .sort-zone.filled').addClass('incorrect');
                        $('#submit-btn').hide();
                        $('#resubmit-btn').show();
                        showDragFeedback('incorrect', 'ğŸ’ª ì´ì „ ì œì¶œ: ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!');
                        
                        console.log('âŒ ì˜¤ë‹µ ìƒíƒœë¡œ ë³µì› ì™„ë£Œ');
                    {% endif %}
                }, 300);
                
                // ìƒíƒœ ë©”ì‹œì§€ ì¶”ê°€
                const statusHtml = `
                    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>ì´ì „ ì œì¶œ ì •ë³´</strong>
                        </div>
                        <div class="mt-2 text-sm text-blue-700">
                            ì œì¶œì¼: {{ existing_answer.submitted_at|date:"Y-m-d H:i" }}<br>
                            ìœ í˜•: ë“œë˜ê·¸ì•¤ë“œë¡­<br>
                            ê²°ê³¼: {% if is_already_correct %}<span class="text-green-600 font-bold">âœ… ì •ë‹µ</span>{% else %}<span class="text-red-600 font-bold">âŒ ì˜¤ë‹µ</span>{% endif %}
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    $('#feedback-{{ is_already_correct|yesno:"correct,incorrect" }}').append(statusHtml);
                }, 1000);
            }
        } catch (e) {
            console.error('Drag ë‹µì•ˆ ë³µì› ì¤‘ ì˜¤ë¥˜:', e);
        }
        {% endif %}
    }
    
    // Drag ì¬ì‹œë„ìš© ë¦¬ì…‹
    function resetDragQuizForRetry() {
        {% if not is_already_correct %}
        console.log('Drag í€´ì¦ˆ ì¬ì‹œë„ ë¦¬ì…‹');
        
        dragIsAnswered = false;
        currentState = {};
        draggedItem = null;
        touchItem = null;
        
        // UI ì´ˆê¸°í™”
        $('.drop-zone, .sort-zone').removeClass('filled highlight correct incorrect').removeAttr('data-filled-by');
        $('.drop-zone').text('ë¹ˆì¹¸');
        $('.sort-zone .zone-label').siblings().remove();
        $('.drag-item').removeClass('placed dragging').show();
        $('#right-gif, #wrong-gif').addClass('hidden');
        $('#feedback-correct, #feedback-incorrect').removeClass('show');
        $('#animation-container').empty();
        
        // í”¼ë“œë°± ë‚´ìš© ì´ˆê¸°í™”
        $('#feedback-correct, #feedback-incorrect').empty();
        
        console.log('ì¬ì‹œë„ ì¤€ë¹„ ì™„ë£Œ');
        {% endif %}
    }
    
    // Drag ì™„ì „ ë¦¬ì…‹
    function resetDragQuiz() {
        console.log('Drag í€´ì¦ˆ ì™„ì „ ë¦¬ì…‹');
        
        dragIsAnswered = false;
        currentState = {};
        draggedItem = null;
        touchItem = null;
        
        // ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”
        $('.drop-zone, .sort-zone').removeClass('filled highlight correct incorrect').removeAttr('data-filled-by');
        $('.drop-zone').text('ë¹ˆì¹¸');
        $('.sort-zone .zone-label').siblings().remove();
        $('.drag-item').removeClass('placed dragging').show().removeAttr('style');
        $('#right-gif, #wrong-gif').addClass('hidden');
        $('#feedback-correct, #feedback-incorrect').removeClass('show');
        $('#animation-container').empty();
        $('#submission-status-wrapper').empty();
        
        // í”¼ë“œë°± ë‚´ìš© ì´ˆê¸°í™”
        $('#feedback-correct, #feedback-incorrect').empty();
        
        console.log('ì™„ì „ ë¦¬ì…‹ ì™„ë£Œ');
    }
    
    // ì œì¶œ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateDragSubmissionStatus(response) {
        const wrapper = $('#submission-status-wrapper');
        wrapper.empty();
        
        const statusIcon = response.is_correct
            ? '<span class="text-green-600 font-medium ml-2"><i class="fas fa-check-circle"></i> ì •ë‹µ</span>'
            : '<span class="text-red-600 font-medium ml-2"><i class="fas fa-times-circle"></i> ì˜¤ë‹µ</span>';
        
        const statusHtml = `<div class="mt-4 text-sm text-gray-600">
            <i class="fas fa-info-circle mr-1"></i>
            ë§ˆì§€ë§‰ ì œì¶œ: ${response.submitted_at}
            ${statusIcon}
        </div>`;
        
        wrapper.html(statusHtml);
    }
    
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function adjustBrightness(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = (num >> 8 & 0x00FF) + amt;
        const B = (num & 0x0000FF) + amt;
        return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }
    
    function getRandomMessage(messages) {
        return messages[Math.floor(Math.random() * messages.length)];
    }
    
    function showDragToast(message, type = 'info') {
        showToast(message, type); // ê¸°ì¡´ í† ìŠ¤íŠ¸ í•¨ìˆ˜ ì‚¬ìš©
    }
    
    // ì‚¬ìš´ë“œ íš¨ê³¼ í•¨ìˆ˜
    function playDragSound(type) {
        try {
            if (type === 'start') {
                console.log('ğŸµ ë“œë˜ê·¸ ì‹œì‘ ì‚¬ìš´ë“œ');
            } else if (type === 'end') {
                console.log('ğŸµ ë“œë˜ê·¸ ì¢…ë£Œ ì‚¬ìš´ë“œ');
            } else if (type === 'success') {
                console.log('ğŸµ ë“œë¡­ ì„±ê³µ ì‚¬ìš´ë“œ');
            }
        } catch (e) {
            // ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨ì‹œ ë¬´ì‹œ
        }
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    $(document).on('click', '#resubmit-btn', function() {
        if ('{{ slide.content_type.type_name }}' === 'drag') {
            resetDragQuizForRetry();
        }
    });
    
    // í™”ë©´ íšŒì „ ëŒ€ì‘
    $(window).on('orientationchange resize', function() {
        setTimeout(() => {
            // íŒŒí‹°í´ ì¬ìƒì„±
            const theme = $('#drag-quiz-container').attr('data-theme') || 'default';
            createDragParticles(theme);
        }, 100);
    });
    
    // Drag í€´ì¦ˆ ì´ˆê¸°í™” ì‹¤í–‰
    initializeDragQuiz();
});
</script>